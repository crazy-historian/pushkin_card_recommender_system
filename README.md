# README.md

# Рекомендательная система для проекта “Пушкинская карта”

Это приложение составляет список рекомендованных культурных мероприятий из списка “Пушкинской карты” для каждого пользователя.

В качестве алгоритмов составления рекомендаций используются методы [*Collaborative Filtering for Implicit Feedback*](http://yifanhu.net/PUB/cf.pdf). Это обусловлено тем, что активность пользователей и их заинтересованность в мероприятии оценивается по числу кликов, совершенными в мобильном приложении.

В сценарии выполнения по умолчанию приложение составляет список рекомендаций для всех пользователей в конкретном регионе и сохраняет его в виде json файла. В этом же сценарии пользователям из конкретного региона рекомендуются мероприятия, которые проводятся в этом же регионе. 

## Как запустить приложение

Сценарий по умолчанию состоит из последовательности выполнения четырех python скриптов:

1. unpack_rars.py — распаковка архивов датасетов и создание необходимых директорий
2. prepare_dataframes.py — предобработка исходных данных
3. create_user_event_dfs.py — создание датафреймов для каждого региона
4. make_recommendations.py — создание списка рекомендаций для всех пользователей в каждом регионе и сохранение его в виде json файла

![Default scenario.jpg](https://github.com/crazy-historian/pushkin_card_recommender_system/blob/main/Default_scenario.jpg?raw=true)

### Linux and Docker

В склонированном репозитории необходимо запустить bash скрипт *run_docker.sh,* который создает докер-образ с интерпретатором python и необходимыми зависимостями, после чего запускается контейнер с монтированными директориями /app и /data
``` shell
source run_docker.sh
```

### Windows

Для запуска приложения в Windows есть batch скрипт, который в склонированном репозитории создает виртуальную среду, устанавливает необходимые зависимости и запускает последовательность скриптов.
```shell
 .\run_win.bat
```

Примечание: для того, чтобы скрипт мог активировать виртуальную среду, необходимо запустить от имени администратора PowerShell и ввести команду *Set-ExecutionPolicy RemoteSigned.* На вопросы в интерактивном режиме необходимо ответить *A*

## Пример использования рекомендательной модели

Во время разработки рекомендательной системы основной упор был сделан на то, чтобы максимально изолировать код модели от пайплана очистки и предобработки предоставленных данных (которые, очевидно, являются сильно вычищенной выгрузкой из БД) . Это позволит в дальнейшем задействовать модели рекомендаций при любой другом способе выборки и предобработки данных.

```python
import pandas as pd
from recommenders.implicit_models import ALSRecommender

user_event_df = pd.read_csv('user_event_df.csv')

"""
      	user_event_df should looks like this:
        +---------+---------+--------+----------+----------+
        | user_id | item_id | rating | user_num | item_num |
        +---------+---------+--------+----------+----------+
        
"""

recommender = ALSRecommender(
    confidence='alpha',
    alpha_value=15
)
recommender.fit(user_event_df)
recommender.get_all_recommendation()
recommender.save_as_json('recommendations')

```



